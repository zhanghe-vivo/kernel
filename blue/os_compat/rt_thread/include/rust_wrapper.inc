#ifndef KERN_RUST_WRAPPER_H
#define KERN_RUST_WRAPPER_H

/* Warning, this file is autogenerated by cbindgen. Don't modify this manually. */

enum ObjectClassType {
  ObjectClassUninit = 0,
  ObjectClassProcess,
  ObjectClassThread,
#if defined(RT_USING_SEMAPHORE)
  ObjectClassSemaphore,
#endif
#if defined(RT_USING_MUTEX)
  ObjectClassMutex,
#endif
#if defined(RT_USING_EVENT)
  ObjectClassEvent,
#endif
#if defined(RT_USING_MAILBOX)
  ObjectClassMailBox,
#endif
#if defined(RT_USING_MESSAGEQUEUE)
  ObjectClassMessageQueue,
#endif
  ObjectClassMemHeap,
  ObjectClassMemPool,
  ObjectClassDevice,
  ObjectClassTimer,
  ObjectClassMemory,
  ObjectClassUnknown,
};
typedef uint8_t ObjectClassType;

/**
 * Base kernel Object
 */
typedef struct rt_object {
  /**
   * TODO: change type to String
   * name of kernel object
   */
  int8_t name[NAME_MAX];
  /**
   * type of kernel object
   */
  uint8_t type_;
  /**
   * list node of kernel object
   */
  rt_list_t list;
} rt_object;

/**
 * Base structure of IPC object
 */
typedef struct rt_ipc_object {
  /**
   * Inherit from KObjectBase
   */
  struct rt_object parent;
  /**
   * IPC flag to use
   */
  uint8_t flag;
  /**
   * Spin lock IPCObject used
   */
  struct RawSpin spinlock;
  /**
   * Threads pended on this IPC object
   */
  rt_list_t wait_list;
  /**
   * IRQ lock saved
   */
  int32_t irq_saved;
} rt_ipc_object;

/**
 * Event flag raw structure
 */
typedef struct rt_event {
  /**
   * Inherit from IPCObject
   */
  struct rt_ipc_object parent;
  /**
   * Event flog set value
   */
  uint32_t set;
} rt_event;

/**
 * The timer structure
 */
typedef struct rt_timer {
  struct rt_object parent;
  TimeoutFn timeout_func;
  void *parameter;
  uint32_t init_tick;
  uint32_t timeout_tick;
  uint8_t flag;
  rt_list_t node;
} rt_timer;

/**
 * Stack management structure
 */
typedef struct rt_stack {
  /**
   * Current stack pointer
   */
  uintptr_t *sp;
  /**
   * Pointer to the lowest address of the stack
   */
  uint8_t *bottom;
  /**
   * Stack size
   */
  uintptr_t size;
} rt_stack;

typedef struct rt_thread {
  struct rt_object parent;
  /**
   * the thread list, used in ready_list\ipc wait_list\...
   */
  rt_list_t tlist;
  /**
   * thread status
   */
  unsigned char stat;
  unsigned char sched_flag_ttmr_set;
  /**
   * priority manager
   */
  unsigned char current_priority;
  unsigned char init_priority;
  unsigned char number;
  unsigned char high_mask;
  unsigned int number_mask;
  /**
   * priority number mask
   * time slice
   */
  unsigned int init_tick;
  unsigned int remaining_tick;
  /**
   * built-in thread timer, used for wait timeout
   */
  struct rt_timer thread_timer;
  /**
   * stack point and entry
   */
  struct rt_stack stack;
  uintptr_t *entry;
  uintptr_t *parameter;
  uintptr_t *cleanup;
#if defined(RT_USING_SMP)
  /**
   * thread binds to cpu
   */
  unsigned char bind_cpu
#endif
  ;
#if defined(RT_USING_SMP)
  /**
   * running on cpu id
   */
  unsigned char oncpu
#endif
  ;
  /**
   * critical lock count
   */
  struct RawSpin spinlock;
  /**
   * error code
   */
  int error;
#if defined(RT_USING_MUTEX)
  /**
   * mutexes holded by this thread
   */
  rt_list_t taken_object_list
#endif
  ;
#if defined(RT_USING_MUTEX)
  /**
   * mutex object
   */
  struct rt_object *pending_object
#endif
  ;
#if defined(RT_USING_EVENT)
  unsigned int event_set
#endif
  ;
#if defined(RT_USING_EVENT)
  unsigned char event_info
#endif
  ;
#if defined(RT_DEBUGING_SPINLOCK)
  struct RawSpin *wait_lock
#endif
  ;
#if defined(RT_DEBUGING_SPINLOCK)
  struct RawSpin *hold_locks[8]
#endif
  ;
#if defined(RT_DEBUGING_SPINLOCK)
  uintptr_t hold_count
#endif
  ;
  uintptr_t tid;
} rt_thread;

typedef struct rt_mutex {
  /**
   * Inherit from IPCObject
   */
  struct rt_ipc_object parent;
  /**
   * Priority ceiling of mutex
   */
  uint8_t ceiling_priority;
  /**
   * Maximal priority for pending thread
   */
  uint8_t priority;
  /**
   * Numbers of thread hold the mutex
   */
  uint8_t hold;
  /**
   * Current owner of mutex
   */
  struct rt_thread *owner;
  /**
   * The object list taken by thread
   */
  rt_list_t taken_list;
} rt_mutex;

/**
 * Mailbox raw structure
 */
typedef struct rt_mailbox {
  /**
   * Inherit from IPCObject
   */
  struct rt_ipc_object parent;
  /**
   * Message pool buffer of mailbox
   */
  uint8_t *msg_pool;
  /**
   * Message pool buffer size
   */
  uint16_t size;
  /**
   * Index of messages in message pool
   */
  uint16_t entry;
  /**
   * Input offset of the message buffer
   */
  uint16_t in_offset;
  /**
   * Output offset of the message buffer
   */
  uint16_t out_offset;
  /**
   * Sender thread suspended on this mailbox
   */
  rt_list_t suspend_sender_thread;
} rt_mailbox;

/**
 * MessageQueue raw structure
 */
typedef struct rt_messagequeue {
  /**
   * Inherit from IPCObject
   */
  struct rt_ipc_object parent;
  /**
   * Start address of message queue
   */
  uint8_t *msg_pool;
  /**
   * Message size of each message
   */
  uint16_t msg_size;
  /**
   * Max number of messages
   */
  uint16_t max_msgs;
  /**
   * Index of messages in the queue
   */
  uint16_t entry;
  /**
   * List head
   */
  uint8_t *msg_queue_head;
  /**
   * List tail
   */
  uint8_t *msg_queue_tail;
  /**
   * Pointer indicated the free node of queue
   */
  uint8_t *msg_queue_free;
  /**
   * Sender thread suspended on this message queue
   */
  rt_list_t suspend_sender_thread;
} rt_messagequeue;

/**
 * Semaphore raw structure
 */
typedef struct rt_semaphore {
  /**
   * Inherit from IPCObject
   */
  struct rt_ipc_object parent;
  /**
   * Value of semaphore
   */
  uint16_t value;
} rt_semaphore;

#endif /* KERN_RUST_WRAPPER_H */
